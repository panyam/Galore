!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("galore",[],t):"object"==typeof exports?exports.galore=t():(e.galore=e.galore||{},e.galore.PlaygroundPage=t())}(this,()=>(()=>{"use strict";var e,t={8526(e,t,n){n.r(t),n.d(t,{PlaygroundPage:()=>u});var r=n(9666),i=(n(5188),n(9058));class a{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}emit(e,...t){this.listeners.get(e)?.forEach(n=>{try{n(...t)}catch(t){console.error(`Error in event handler for ${e}:`,t)}})}}const s="grammarCompiled",o="inputParsed",l=[{name:"Calculator",label:"Calculator",selected:!0,grammar:'\n%token NUMBER /\\d+(\\.\\d+)?/\n%token ID /[a-zA-Z_][a-zA-Z0-9_]*/\n%skip /[ \\t\\n\\f\\r]+/\n\nProgram -> Statement* ;\nStatement -> Assignment ";" | Expr ";" ;\nAssignment -> ID "=" Expr ;\nExpr -> Expr "+" Term | Expr "-" Term | Term ;\nTerm -> Term "*" Factor | Term "/" Factor | Factor ;\nFactor -> ParenExpr | NUMBER | FuncCall | "-" Factor ;\nFuncCall -> ID | ID ParenExpr | ID CommaExprList ;\nCommaExprList -> "(" Expr ( "," Expr ) + ")" | "(" ")";\nParenExpr -> "(" Expr ")" ;\n    '.trim(),sampleInput:"x = 10;\ny = 20;\nx + y * 2;",actionCode:'// Calculator evaluator with statement formatting\nconst vars = {};\nconst output = [];\n\n// Convert parse tree node to source text (without ";")\nfunction nodeToString(n) {\n  if (!n) return "";\n  if (n.value !== undefined && !n.children?.length) return n.value;\n  if (n.children) {\n    return n.children\n      .filter(c => c.sym?.label !== ";")\n      .map(nodeToString).join(" ");\n  }\n  return "";\n}\n\nfunction evaluate(n) {\n  if (!n) return 0;\n  const sym = n.sym?.label;\n  const kids = n.children || [];\n\n  if (sym === "NUMBER") return parseFloat(n.value);\n  if (sym === "ID") return vars[n.value] ?? 0;\n\n  if (sym === "Assignment") {\n    const name = kids[0].value;\n    const val = evaluate(kids[2]);\n    vars[name] = val;\n    return val;\n  }\n\n  if (sym === "Expr" || sym === "Term") {\n    if (kids.length === 3) {\n      const l = evaluate(kids[0]);\n      const op = kids[1].value;\n      const r = evaluate(kids[2]);\n      if (op === "+") return l + r;\n      if (op === "-") return l - r;\n      if (op === "*") return l * r;\n      if (op === "/") return l / r;\n    }\n  }\n\n  if (sym === "Factor") {\n    // Factor -> ParenExpr | NUMBER | FuncCall (1 child) or "-" Factor (2 children)\n    if (kids.length === 1) {\n      return evaluate(kids[0]);\n    } else if (kids.length === 2) {\n      // Unary minus: "-" Factor\n      return -evaluate(kids[1]);\n    }\n    return 0;\n  }\n\n  if (sym === "ParenExpr") {\n    // ParenExpr -> "(" Expr ")" (3 children, middle is Expr)\n    return evaluate(kids[1]);\n  }\n\n  if (sym === "FuncCall") {\n    const funcName = kids[0].value;\n\n    // FuncCall -> ID (just a variable reference)\n    if (kids.length === 1) {\n      return vars[funcName] ?? 0;\n    }\n\n    // FuncCall -> ID ParenExpr (single argument function)\n    if (kids.length === 2 && kids[1].sym?.label === "ParenExpr") {\n      const arg = evaluate(kids[1]);\n      if (typeof Math[funcName] === \'function\') {\n        return Math[funcName](arg);\n      }\n      return 0;\n    }\n\n    // FuncCall -> ID CommaExprList (multiple argument function)\n    if (kids.length === 2 && kids[1].sym?.label === "CommaExprList") {\n      const argList = kids[1].children || [];\n      const args = argList\n        .filter(c => c.sym?.label === "Expr")\n        .map(c => evaluate(c));\n      if (typeof Math[funcName] === \'function\') {\n        return Math[funcName](...args);\n      }\n      return 0;\n    }\n\n    return 0;\n  }\n\n  if (sym === "Statement") {\n    const stmtNode = kids[0];\n    const text = nodeToString(stmtNode);\n    const val = evaluate(stmtNode);\n    output.push(text + "  â†’  " + val);\n    return val;\n  }\n\n  if (sym === "Program") {\n    for (const stmt of kids) evaluate(stmt);\n    return output.join("\\n");\n  }\n\n  // Default: recurse\n  let result = 0;\n  for (const c of kids) result = evaluate(c);\n  return result;\n}\n\nreturn evaluate(node);'},{name:"JSON",label:"JSON",grammar:'\n%token NUMBER /-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?/\n%token STRING /".*?(?<!\\\\)"/\n%skip /[ \\t\\n\\f\\r]+/\n\nValue -> Dict | List | STRING | NUMBER | Boolean | "null" ;\nList -> "[" [ Value ( "," Value ) * ] "]" ;\nDict -> "{" [ Pair ("," Pair)* ] "}" ;\nPair -> STRING ":" Value ;\nBoolean -> "true" | "false" ;\n    '.trim(),sampleInput:'{\n  "name": "Milky Way",\n  "age": 4600000000,\n  "star": "sun",\n  "planets": [ "Mercury", "Venus", "Earth" ],\n  "hot": true,\n  "x": null\n}'},{name:"Arithmetic",label:"Arithmetic",grammar:'\n%token NUMBER /\\d+/\n%skip /[ \\t\\n\\f\\r]+/\n\nExpr -> Expr "+" Term | Expr "-" Term | Term ;\nTerm -> Term "*" Factor | Term "/" Factor | Factor ;\nFactor -> "(" Expr ")" | NUMBER | "-" Factor ;\n    '.trim(),sampleInput:"1 + 2 * 3",actionCode:'// Simple arithmetic evaluator\nfunction evaluate(n) {\n  if (!n) return 0;\n  const sym = n.sym?.label;\n  const kids = n.children || [];\n\n  if (sym === "NUMBER") return parseInt(n.value);\n\n  if (sym === "Expr" || sym === "Term") {\n    if (kids.length === 3) {\n      const l = evaluate(kids[0]);\n      const op = kids[1].value;\n      const r = evaluate(kids[2]);\n      if (op === "+") return l + r;\n      if (op === "-") return l - r;\n      if (op === "*") return l * r;\n      if (op === "/") return l / r;\n    }\n  }\n\n  if (sym === "Factor") {\n    // NUMBER (1 child), "(" Expr ")" (3 children), or "-" Factor (2 children)\n    if (kids.length === 1) {\n      return evaluate(kids[0]);\n    } else if (kids.length === 2) {\n      // Unary minus: "-" Factor\n      return -evaluate(kids[1]);\n    } else if (kids.length === 3) {\n      // Parenthesized expression: middle child is the Expr\n      return evaluate(kids[1]);\n    }\n    return 0;\n  }\n\n  // Default: recurse\n  for (const c of kids) {\n    const v = evaluate(c);\n    if (v !== undefined) return v;\n  }\n  return 0;\n}\n\nreturn evaluate(node);'},{name:"FarshiG3",label:"Farshi G3 (Ambiguous)",grammar:'\n%token b "b"\n%token x "x"\n%skip /[ \\t\\n\\f\\r]+/\n\nS -> A S b ;\nS -> x ;\nA -> ;\n    '.trim(),sampleInput:"x b b"},{name:"DanglingElse",label:"Dangling Else (Conflict)",grammar:'\n%token IF "if"\n%token THEN "then"\n%token ELSE "else"\n%token EXPR "expr"\n%token OTHER "other"\n%skip /[ \\t\\n\\f\\r]+/\n\nStmt -> IF EXPR THEN Stmt\n      | IF EXPR THEN Stmt ELSE Stmt\n      | OTHER ;\n    '.trim(),sampleInput:"if expr then if expr then other else other"},{name:"AmbiguousExpr",label:"Ambiguous Expr (Conflict)",grammar:'\n%token NUMBER /\\d+/\n%skip /[ \\t\\n\\f\\r]+/\n\nE -> E "+" E | E "*" E | NUMBER ;\n    '.trim(),sampleInput:"1 + 2 * 3"}];var c=n(6383),m=n(4516);n(2145),n(621),n(8542),n(8005),window.G=i;const d="galore-playground-layout";class u{constructor(){this.dockview=null,this.eventHub=new a,this.currentParser=null,this.currentGrammar=null,this.currentItemGraph=null,this.parserType="lalr",this.grammarEditor=null,this.inputEditor=null,this.normalizedEditor=null,this.actionEditor=null,this.parseTreeContainer=null,this.parseTableContainer=null,this.consoleOutput=null,this.actionCompiler=null,this.lastParseResult=null,this.actionCodeStorage=new Map,this.currentGrammarName="",this.init()}isDarkMode(){return document.documentElement.classList.contains("dark")}getEditorTheme(){return this.isDarkMode()?"ace/theme/monokai":"ace/theme/github"}init(){const e=document.getElementById("dockview-container");if(!e)return void console.error("Dockview container not found");e.className=this.isDarkMode()?"dockview-theme-dark":"dockview-theme-light",new MutationObserver(()=>{const t=this.isDarkMode();e.className=t?"dockview-theme-dark":"dockview-theme-light",this.updateEditorThemes(t)}).observe(document.documentElement,{attributes:!0,attributeFilter:["class"]});const t=new r.ax(e,{createComponent:e=>this.createComponent(e)});this.dockview=t.api,this.loadLayout()||this.createDefaultLayout(),this.dockview.onDidLayoutChange(()=>{this.saveLayout()}),this.setupEventListeners(),this.selectGrammar(l.find(e=>e.selected)||l[0]),setTimeout(()=>this.updateEditorThemes(this.isDarkMode()),100),setTimeout(()=>this.updateEditorThemes(this.isDarkMode()),500)}saveLayout(){if(this.dockview)try{const e=this.dockview.toJSON();localStorage.setItem(d,JSON.stringify(e))}catch(e){console.warn("Failed to save layout:",e)}}loadLayout(){if(!this.dockview)return!1;try{const e=localStorage.getItem(d);if(e){const t=JSON.parse(e);return this.dockview.fromJSON(t),!0}}catch(e){console.warn("Failed to load layout:",e),localStorage.removeItem(d)}return!1}createComponent(e){switch(e.name){case"grammar":return this.createGrammarPanel();case"input":return this.createInputPanel();case"parseTree":return this.createParseTreePanel();case"parseTable":return this.createParseTablePanel();case"normalizedGrammar":return this.createNormalizedGrammarPanel();case"console":return this.createConsolePanel();case"actions":return this.createActionsPanel();default:return{element:document.createElement("div")}}}createDefaultLayout(){this.dockview&&(this.dockview.addPanel({id:"grammar",component:"grammar",title:"Grammar"}),this.dockview.addPanel({id:"parseTree",component:"parseTree",title:"Parse Tree",position:{direction:"left",referencePanel:"grammar"}}),this.dockview.addPanel({id:"parseTable",component:"parseTable",title:"Parse Table",position:{direction:"right",referencePanel:"grammar"}}),this.dockview.addPanel({id:"input",component:"input",title:"Input",position:{direction:"below",referencePanel:"grammar"}}),this.dockview.addPanel({id:"console",component:"console",title:"Console",position:{direction:"below",referencePanel:"input"}}),this.dockview.addPanel({id:"normalizedGrammar",component:"normalizedGrammar",title:"Normalized Grammar",position:{direction:"within",referencePanel:"grammar"}}),this.dockview.addPanel({id:"actions",component:"actions",title:"Actions",position:{direction:"within",referencePanel:"input"}}))}createGrammarPanel(){const e=document.getElementById("grammar-panel-template");if(!e)return{element:document.createElement("div")};const t=e.cloneNode(!0);return t.style.display="flex",t.style.flexDirection="column",t.style.height="100%",{element:t,init:()=>{const e=t.querySelector("#grammar-select");e&&(e.innerHTML=l.map(e=>`<option value="${e.name}" ${e.selected?"selected":""}>${e.label}</option>`).join(""),e.addEventListener("change",()=>{const t=l.find(t=>t.name===e.value);t&&this.selectGrammar(t)}));const n=t.querySelector("#parser-type-select");n&&n.addEventListener("change",()=>{this.parserType=n.value});const r=t.querySelector("#compile-btn");r&&r.addEventListener("click",()=>this.compile());const i=t.querySelector("#grammar-editor");i&&(this.grammarEditor=m.edit(i),this.grammarEditor.setTheme(this.getEditorTheme()),this.grammarEditor.session.setMode("ace/mode/text"),this.grammarEditor.setOptions({fontSize:"14px",showPrintMargin:!1}))}}}createInputPanel(){const e=document.getElementById("input-panel-template");if(!e)return{element:document.createElement("div")};const t=e.cloneNode(!0);return t.style.display="flex",t.style.flexDirection="column",t.style.height="100%",{element:t,init:()=>{const e=t.querySelector("#parse-btn");e&&e.addEventListener("click",()=>this.parse());const n=t.querySelector("#input-editor");n&&(this.inputEditor=m.edit(n),this.inputEditor.setTheme(this.getEditorTheme()),this.inputEditor.session.setMode("ace/mode/text"),this.inputEditor.setOptions({fontSize:"14px",showPrintMargin:!1}))}}}createParseTreePanel(){const e=document.getElementById("parse-tree-panel-template");if(!e)return{element:document.createElement("div")};const t=e.cloneNode(!0);return t.style.display="flex",t.style.height="100%",t.style.overflow="auto",{element:t,init:()=>{this.parseTreeContainer=t.querySelector("#parse-tree-container")}}}createParseTablePanel(){const e=document.getElementById("parse-table-panel-template");if(!e)return{element:document.createElement("div")};const t=e.cloneNode(!0);return t.style.display="flex",t.style.height="100%",t.style.overflow="auto",{element:t,init:()=>{this.parseTableContainer=t.querySelector("#parse-table-container")}}}createNormalizedGrammarPanel(){const e=document.getElementById("normalized-grammar-panel-template");if(!e)return{element:document.createElement("div")};const t=e.cloneNode(!0);return t.style.display="flex",t.style.height="100%",{element:t,init:()=>{const e=t.querySelector("#normalized-grammar-editor");e&&(this.normalizedEditor=m.edit(e),this.normalizedEditor.setTheme(this.getEditorTheme()),this.normalizedEditor.session.setMode("ace/mode/text"),this.normalizedEditor.setReadOnly(!0),this.normalizedEditor.setOptions({fontSize:"14px",showPrintMargin:!1}))}}}createConsolePanel(){const e=document.getElementById("console-panel-template");if(!e)return{element:document.createElement("div")};const t=e.cloneNode(!0);return t.style.display="flex",t.style.flexDirection="column",t.style.height="100%",{element:t,init:()=>{this.consoleOutput=t.querySelector("#console-output");const e=t.querySelector("#clear-console-btn");e&&e.addEventListener("click",()=>{this.consoleOutput&&(this.consoleOutput.innerHTML="")})}}}createActionsPanel(){const e=document.getElementById("actions-panel-template");if(!e)return{element:document.createElement("div")};const t=e.cloneNode(!0);return t.style.display="flex",t.style.flexDirection="column",t.style.height="100%",{element:t,init:()=>{const e=t.querySelector("#action-editor");if(e){this.actionEditor=m.edit(e),this.actionEditor.setTheme(this.getEditorTheme()),this.actionEditor.session.setMode("ace/mode/javascript"),this.actionEditor.setOptions({fontSize:"14px",showPrintMargin:!1});const n=t.querySelector("#action-status");this.actionCompiler=new c.SN(this.actionEditor,n)}const n=t.querySelector("#run-action-btn");n&&n.addEventListener("click",()=>this.runAction())}}}runAction(){if(!this.actionCompiler)return void this.log("No action compiler available","error");if(!this.lastParseResult)return void this.log("No parse result available. Parse some input first.","error");const e=this.actionCompiler.run(this.lastParseResult);if(e.success){if(null!==e.result){const t="string"==typeof e.result?e.result:JSON.stringify(e.result);this.log(`Action result:\n${t}`,"success")}}else if(e.error){const t=null!==e.line?` (line ${e.line+1})`:"";this.log(`Action error: ${e.error}${t}`,"error")}}setupEventListeners(){this.eventHub.on(s,(e,t)=>{this.log("Grammar compiled successfully"),this.updateParseTable(),this.updateNormalizedGrammar()}),this.eventHub.on(o,e=>{this.updateParseTree(e)})}selectGrammar(e){if(this.currentGrammarName&&this.actionEditor&&this.actionCodeStorage.set(this.currentGrammarName,this.actionEditor.getValue()),this.currentGrammarName=e.name,this.grammarEditor&&this.grammarEditor.setValue(e.grammar,-1),this.inputEditor&&e.sampleInput&&this.inputEditor.setValue(e.sampleInput,-1),this.actionEditor){const t=this.actionCodeStorage.get(e.name),n=e.actionCode||"";this.actionEditor.setValue(t??n,-1),this.actionCompiler?.compile()}this.lastParseResult=null,this.eventHub.emit("grammarSelected",e)}compile(){if(!this.grammarEditor)return;const e=this.grammarEditor.getValue();try{const t=performance.now(),[n,,r]=i.newParser(e,{type:this.parserType}),a=(performance.now()-t).toFixed(2);this.currentParser=n,this.currentGrammar=n.grammar,this.currentItemGraph=r,this.eventHub.emit(s,this.currentParser,this.currentGrammar),this.log(`Parser compiled (${this.parserType.toUpperCase()}) in ${a}ms`),this.inputEditor&&this.inputEditor.getValue().trim()&&this.parse()}catch(e){this.log(`Compile error: ${e.message}`,"error")}}parse(){if(!this.currentParser||!this.inputEditor)return void this.log("No parser available. Compile the grammar first.","error");const e=this.inputEditor.getValue();try{const t=performance.now(),n=this.currentParser.parse(e),r=(performance.now()-t).toFixed(2);this.lastParseResult=n,this.log(`Parsed in ${r}ms`),this.eventHub.emit(o,n),this.actionCompiler?.hasCompiledAction()&&this.runAction()}catch(e){this.lastParseResult=null,this.log(`Parse error: ${e.message}`,"error")}}updateParseTree(e){if(!this.parseTreeContainer)return;if(this.parseTreeContainer.innerHTML="",!e)return void(this.parseTreeContainer.innerHTML='<div class="empty-message">No parse result</div>');const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("parse-tree-svg");const{element:n,width:r,height:i}=this.renderTreeNode(e,0,0);t.appendChild(n),t.setAttribute("width",String(r+40)),t.setAttribute("height",String(i+40)),t.setAttribute("viewBox",`0 0 ${r+40} ${i+40}`),this.parseTreeContainer.appendChild(t)}renderTreeNode(e,t,n){const r=document.createElementNS("http://www.w3.org/2000/svg","g");let i=e.sym?.label||"?";void 0===e.value||null===e.value||e.children?.length||(i+=`: ${JSON.stringify(e.value)}`);const a=8*i.length+16,s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x",String(t)),s.setAttribute("y",String(n)),s.setAttribute("width",String(a)),s.setAttribute("height",String(28)),s.setAttribute("rx","4"),s.setAttribute("ry","4"),s.classList.add("parse-tree-node"),e.children?.length?s.classList.add("non-terminal"):s.classList.add("terminal"),r.appendChild(s);const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",String(t+8)),o.setAttribute("y",String(n+14+4)),o.classList.add("parse-tree-text"),o.textContent=i,r.appendChild(o);let l=a,c=28;if(e.children?.length){let i=n+28+8;const a=t+24;for(const s of e.children){const e=document.createElementNS("http://www.w3.org/2000/svg","path"),o=`M ${t+12} ${n+28} V ${i+14} H ${a}`;e.setAttribute("d",o),e.classList.add("parse-tree-line"),r.appendChild(e);const m=this.renderTreeNode(s,a,i);r.appendChild(m.element),l=Math.max(l,24+m.width),i+=m.height+8,c=i-n-8}}return{element:r,width:l,height:c}}updateParseTable(){if(this.parseTableContainer&&this.currentParser)try{const e=i.Printers.parseTableToHtml(this.currentParser.parseTable,{itemGraph:this.currentItemGraph});this.parseTableContainer.innerHTML=e;const t=this.parseTableContainer.querySelectorAll("td.multipleActions");t.length>0&&this.log(`Warning: ${t.length} conflict(s) found in parse table`,"error")}catch(e){this.parseTableContainer.innerHTML='<div class="error">Could not render parse table</div>'}}updateNormalizedGrammar(){if(!this.normalizedEditor||!this.currentGrammar)return;const e=this.currentGrammar.debugValue||[];this.normalizedEditor.setValue(e.join("\n"),-1)}updateEditorThemes(e){const t=e?"ace/theme/monokai":"ace/theme/github";this.grammarEditor?.setTheme(t),this.inputEditor?.setTheme(t),this.normalizedEditor?.setTheme(t),this.actionEditor?.setTheme(t)}log(e,t="info"){if(!this.consoleOutput)return;const n=document.createElement("div");n.className=`console-entry console-${t}`;const r=(new Date).toLocaleTimeString();n.innerHTML=`<span class="console-time">[${r}]</span> ${e}`,this.consoleOutput.appendChild(n),this.consoleOutput.scrollTop=this.consoleOutput.scrollHeight}}document.addEventListener("DOMContentLoaded",()=>{window.playgroundPage=new u})}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e](a,a.exports,r),a.loaded=!0,a.exports}r.m=t,r.amdD=function(){throw new Error("define cannot be used indirect")},e=[],r.O=(t,n,i,a)=>{if(!n){var s=1/0;for(m=0;m<e.length;m++){for(var[n,i,a]=e[m],o=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(r.O).every(e=>r.O[e](n[l]))?n.splice(l--,1):(o=!1,a<s&&(s=a));if(o){e.splice(m--,1);var c=i();void 0!==c&&(t=c)}}return t}a=a||0;for(var m=e.length;m>0&&e[m-1][2]>a;m--)e[m]=e[m-1];e[m]=[n,i,a]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={509:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[s,o,l]=n,c=0;if(s.some(t=>0!==e[t])){for(i in o)r.o(o,i)&&(r.m[i]=o[i]);if(l)var m=l(r)}for(t&&t(n);c<s.length;c++)a=s[c],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(m)},n=this.webpackChunkgalore=this.webpackChunkgalore||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.nc=void 0;var i=r.O(void 0,[906,553,944,100],()=>r(8526));return r.O(i)})());
//# sourceMappingURL=PlaygroundPage.d611ae44cd45eb24d156.js.map